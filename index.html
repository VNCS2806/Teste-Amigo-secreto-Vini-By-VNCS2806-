<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Amigo Secreto</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --primary: #22c55e;
      --secondary: #38bdf8;
      --danger: #ef4444;
      --text: #e5e7eb;
      --muted: #9ca3af;
    }

    * { box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    body { margin: 0; background: linear-gradient(135deg, #020617, #0f172a); color: var(--text); }

    header {
      padding: 20px;
      text-align: center;
      font-size: 1.6rem;
      font-weight: bold;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(10px);
    }

    main { max-width: 900px; margin: auto; padding: 20px; }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    h2 { margin-top: 0; }

    input, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
    }

    input { background: #020617; color: var(--text); border: 1px solid #1f2937; }
    button { background: var(--primary); color: #052e16; font-weight: bold; cursor: pointer; }
    button.secondary { background: var(--secondary); color: #042f2e; }
    button.danger { background: var(--danger); color: white; }

    .list { margin-top: 10px; }
    .list div { padding: 8px; border-bottom: 1px solid #1f2937; }

    .muted { color: var(--muted); font-size: 0.9rem; }
  </style>
</head>
<body>
  <header>üéÅ Amigo Secreto</header>

  <main>
    <div class="card" id="home">
      <h2>Eventos</h2>
      <button onclick="criarEvento()">Criar novo evento</button>
      <div class="list" id="listaEventos"></div>
    </div>

    <div class="card" id="evento" style="display:none"></div>
  </main>

<script>
const LS = localStorage;
const eventosKey = 'amigoSecreto_eventos';

function getEventos() {
  return JSON.parse(LS.getItem(eventosKey) || '[]');
}

function setEventos(e) {
  LS.setItem(eventosKey, JSON.stringify(e));
}

function criarEvento() {
  const nome = prompt('Nome do evento:');
  if (!nome) return;
  const eventos = getEventos();
  const id = crypto.randomUUID();
  eventos.push({ id, nome, participantes: [], sorteio: {}, revelado: false });
  setEventos(eventos);
  renderEventos();
}

function renderEventos() {
  const lista = document.getElementById('listaEventos');
  lista.innerHTML = '';
  getEventos().forEach(ev => {
    const div = document.createElement('div');
    div.innerHTML = `<b>${ev.nome}</b><br><button class='secondary' onclick='abrirEvento("${ev.id}")'>Abrir</button>
    <button class='danger' onclick='excluirEvento("${ev.id}")'>Excluir</button>`;
    lista.appendChild(div);
  });
}

function excluirEvento(id) {
  if (!confirm('Excluir este evento?')) return;
  setEventos(getEventos().filter(e => e.id !== id));
  renderEventos();
}

function abrirEvento(id) {
  const ev = getEventos().find(e => e.id === id);
  const area = document.getElementById('evento');
  area.style.display = 'block';
  area.innerHTML = `
    <h2>${ev.nome}</h2>
    <p class='muted'>Link do evento: ${location.href.split('#')[0]}#${ev.id}</p>
    <input id='nomeParticipante' placeholder='Nome do participante'>
    <button onclick='addParticipante("${ev.id}")'>Adicionar participante</button>
    <div class='list'>${ev.participantes.map(p=>`<div>${p}</div>`).join('')}</div>
    <button class='secondary' onclick='sortear("${ev.id}")'>Sortear</button>
    <button onclick='voltar()'>Voltar</button>
  `;
}

function addParticipante(id) {
  const nome = document.getElementById('nomeParticipante').value.trim();
  if (!nome) return;
  const eventos = getEventos();
  const ev = eventos.find(e => e.id === id);
  if (!ev.participantes.includes(nome)) ev.participantes.push(nome);
  setEventos(eventos);
  abrirEvento(id);
}

function sortear(id) {
  const eventos = getEventos();
  const ev = eventos.find(e => e.id === id);
  if (ev.participantes.length < 2) return alert('Poucos participantes');
  const nomes = [...ev.participantes];
  const sorteio = {};
  const embaralhado = nomes.sort(() => Math.random() - 0.5);
  embaralhado.forEach((n, i) => sorteio[n] = embaralhado[(i + 1) % embaralhado.length]);
  ev.sorteio = sorteio;
  ev.revelado = true;
  setEventos(eventos);
  alert('Sorteio realizado!');
}

function voltar() {
  document.getElementById('evento').style.display = 'none';
}

renderEventos();
</script>
</body>
</html>
